<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>JARVIK KOSTAL GPT</title>
</head>
<body>
    <h1>Chat</h1>
    <form id="askForm">
        User: <input type="text" id="user" value="anon"><br>
        Endpoint: <select id="config"></select><br>
        Question: <input type="text" id="message" size="60"><br>
        <button type="submit">Ask</button>
    </form>
    <h3>Answer</h3>
    <pre id="response"></pre>
    <h3>Context</h3>
    <pre id="context"></pre>

    <h2>Add Knowledge</h2>
    <form id="knowledgeForm" enctype="multipart/form-data">
        Title: <input type="text" name="title"><br>
        Comment: <input type="text" name="comment"><br>
        Category: <input type="text" name="category"><br>
        Text:<br>
        <textarea name="text" rows="4" cols="60"></textarea><br>
        File: <input type="file" name="file"><br>
        <button type="submit">Upload</button>
    </form>
    <pre id="uploadStatus"></pre>

<script>
document.getElementById('askForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const user = document.getElementById('user').value;
    const message = document.getElementById('message').value;
    const config = document.getElementById('config').value;
    const res = await fetch('/ask', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({user, message, config})
    });
    const data = await res.json();
    document.getElementById('response').textContent = data.response || '';
    const ctx = (data.references || []).map(r => {
        const cat = r.category ? ` [${r.category}]` : '';
        const comment = r.comment ? ` - ${r.comment}` : '';
        return `${r.title}${cat}${comment}`;
    }).join('\n');
    document.getElementById('context').textContent = ctx;
});

document.getElementById('knowledgeForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const form = document.getElementById('knowledgeForm');
    const formData = new FormData(form);
        const category = form.querySelector('input[name="category"]').value;
    formData.append("category", category);
    const res = await fetch('/knowledge/add', {
        method: 'POST',
        body: formData
    });
    const data = await res.json();
    document.getElementById('uploadStatus').textContent = JSON.stringify(data);
});

async function loadConfigs() {
    const res = await fetch('/configs');
    const data = await res.json();
    const select = document.getElementById('config');
    Object.keys(data).forEach(name => {
        const opt = document.createElement('option');
        opt.value = name;
        const cfg = data[name];
        opt.textContent = name + (cfg.base_url ? ` - ${cfg.base_url}` : '');
        select.appendChild(opt);
    });
}

document.addEventListener('DOMContentLoaded', loadConfigs);
</script>
</body>
</html>
